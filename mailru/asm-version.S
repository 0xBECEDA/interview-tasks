	.file	"asm-version.s"
	.section	.rodata

format2:
    .string "%d\n"

    .global main
    .type	main, @function
    .text

# проверяет, есть ли у числа единицы в соседних битах
loop:
    pop     %rbx    # взять со стека число-проверку
    pop     %rdx    # взять со стека число-параметр

    mov     %rdx, %rax    # запомнить число-параметр
    mov     %rbx, %rsi    # запомнили число-проверку

    and     %rbx, %rdx    # обнулить лишние разряды, результат в rdx
    cmp     $1, %rsi      # сравниваем число-проверку с единицей
    je      true          # если равны, то выходим через exit_true
    cmp     %rdx, %rsi    # иначе сравниваем результат обнуления с числом-проверкой
    je      false         # если равны, выходм через exit_false

    shr     $1, %rsi      # иначе сдвинули 1 бит вправо у числа-проверки
    push     %rax         # отправили число-параметр в стек
    push     %rsi         # отправили число-проверку в стек

    jmp     loop

# генерирует числа-параметры, которые надо проанализировать
generate_params:
    pop   %rbx                       # получаем число-параметр прошлой итерации
    cmp   $0b1111111111111111, %rbx  # достигли максимального значения?

    je    exit                       # да, выходим

    inc   %rbx                       # нет, инкрементируем значение
    push  %rbx                       # отправляем значение-параметр в стек
    mov   $0b1100000000000000, %rax  # отправляем начальное число-проверку в стек
    push  %rax

    jmp   loop

main:
    pushq	%rbp
    mov     %rsp, %rbp

    mov     $0, %rdx      # начальное значение числа-параметра
    push    %rdx          # пушим его в стек

 	jmp     generate_params

# выход из программы
exit:
    nop
	popq	%rbp
	ret

# печатает число, у которого нет соседствующих единиц
true:
    mov     %rax, %rsi
    mov     %rax, %rbx     # сохраняем число-параметр, потому что printf перезапишет rax
    mov     $format2, %edi
    call    printf
    push    %rbx           # отправляем число-параметр в стек
    jmp     generate_params

# ветка выполняется в случае, если число имеет соседствующие единицы
false:
    push    %rax
    jmp     generate_params
